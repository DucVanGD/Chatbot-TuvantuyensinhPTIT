<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>PTIT Admission Chatbot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="PTIT.png">
  <style>
    :root {
      --primary: #c8102e; /* ƒë·ªè PTIT */
      --primary-dark: #9b0d23;
      --primary-light: #fbe6ea;
      --bg: #f5f5f7;
      --text: #1f2933;
      --border: #e1e4ea;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top left, #ffe5ea 0, #f5f5f7 40%, #ffffff 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color: var(--text);
    }

    .navbar {
      height: 64px;
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .navbar-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .navbar-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: rgb(255, 255, 255);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;

    }

    .navbar-title {
      display: flex;
      flex-direction: column;
    }

    .navbar-title-main {
      font-weight: 700;
      font-size: 18px;
      letter-spacing: 0.02em;
    }

    .navbar-title-sub {
      font-size: 12px;
      opacity: 0.9;
    }


    .page {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 24px;
    }

    .chat-card {
      width: 100%;
      max-width: 920px;
      height: 80vh;
      max-height: 720px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 24px;
      box-shadow:
        0 18px 45px rgba(0, 0, 0, 0.08),
        0 0 0 1px rgba(255, 255, 255, 0.6);
      display: flex;
      overflow: hidden;
      backdrop-filter: blur(16px);
    }

    .chat-sidebar {
      width: 260px;
      background: linear-gradient(160deg, var(--primary-dark), var(--primary));
      color: #fff;
      padding: 20px 18px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .chat-sidebar-header-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.12);
      font-size: 11px;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #f59e0b;
      box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.3);
    }

    .badge-dot.online {
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.3);
    }

    .badge-dot.offline {
      background: #ef4444;
      box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.3);
    }

    .badge-dot.checking {
      background: #f59e0b;
      box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.3);
    }

    .sidebar-section-title {
      font-size: 12px;
      
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.85;
      margin-bottom: 4px;
    }

    .quick-questions {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 4px;
    }

    .quick-question {
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.15);
      font-family: "Nunito", "Segoe UI", sans-serif;
      font-size: 12px;
      line-height: 1.4;
      color:rgb(254, 254, 254);
      cursor: pointer;
      transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.15s ease;
    }

    .quick-question:hover {
      background: rgba(255, 255, 255, 0.18);
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.18);
    }

    .chat-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 18px 18px 14px;
    }

    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 10px;
    }

    .chat-header-title {
      font-weight: 600;
      font-size: 16px;
    }

    .chat-header-sub {
      font-size: 12px;
      color: #6b7280;
      margin-top: 2px;
    }

    .chat-header-chip {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: var(--primary-light);
      color: var(--primary-dark);
      border: 1px solid #f3b5c0;
    }

    .chat-messages {
      flex: 1;
      padding: 8px 4px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
      scroll-behavior: smooth;
    }

    .message-row {
      display: flex;
      gap: 8px;
      max-width: 88%;
    }

    .message-row.user {
      margin-left: auto;
      justify-content: flex-end;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }

    .avatar.bot {
      background: var(--primary-light);
      color: var(--primary-dark);
    }

    .avatar.user {
      background: #e5e7eb;
      color: #111827;
    }

    .bubble {
      padding: 8px 10px;
      border-radius: 14px;
      font-size: 14px;
      line-height: 1.4;
      white-space: pre-wrap;
      word-wrap: break-word;
      background: #f3f4f6;
    }

    .message-row.user .bubble {
      background: var(--primary);
      color: #fff;
      border-bottom-right-radius: 4px;
    }

    .message-row.bot .bubble {
      background: #f9fafb;
      border-bottom-left-radius: 4px;
    }

    .meta {
      font-size: 11px;
      opacity: 0.65;
      margin-top: 2px;
    }

    .chat-input-wrapper {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .chat-input-row {
      display: flex;
      gap: 8px;
      align-items: flex-end;
    }

    .chat-input {
      flex: 1;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      outline: none;
      font-size: 14px;
      background: #f9fafb;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
      resize: none;
      max-height: 80px;
      min-height: 40px;
    }

    .chat-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(200, 16, 46, 0.3);
      background: #ffffff;
    }

    .send-btn {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      background: var(--primary);
      color: #fff;
      font-weight: 600;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(200, 16, 46, 0.4);
      transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.15s ease, opacity 0.1s ease;
      flex-shrink: 0;
    }

    .send-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(200, 16, 46, 0.5);
    }

    .send-btn:active {
      transform: translateY(0);
      box-shadow: 0 6px 12px rgba(200, 16, 46, 0.5);
    }

    .send-btn[disabled] {
      opacity: 0.6;
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    .helper-text {
      font-size: 11px;
      color: #6b7280;
      display: flex;
      justify-content: space-between;
    }

    .error-banner {
      font-size: 12px;
      color: #b91c1c;
      background: #fee2e2;
      border-radius: 999px;
      padding: 4px 10px;
      display: none;
    }

    .error-banner.visible {
      display: inline-flex;
    }

    @media (max-width: 900px) {
      .chat-card {
        flex-direction: column;
        height: 90vh;
      }

      .chat-sidebar {
        width: 100%;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }

      .quick-questions {
        flex-direction: row;
        flex-wrap: wrap;
      }
    }

    @media (max-width: 640px) {
      .navbar {
        padding: 0 16px;
      }

      .page {
        padding: 12px;
      }

      .chat-card {
        height: calc(100vh - 88px);
      }
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="navbar-left">
      <div class="navbar-icon">
        <img src="PTIT.png" alt="PTIT" style="width:26px;height:26px;border-radius:6px;object-fit:contain;" />
      </div>
      <div class="navbar-title">
        <div class="navbar-title-main">PTIT Admission Chatbot</div>
        <div class="navbar-title-sub">T∆∞ v·∫•n tuy·ªÉn sinh H·ªçc vi·ªán C√¥ng ngh·ªá B∆∞u ch√≠nh Vi·ªÖn th√¥ng</div>
      </div>
    </div>
  </header>

  <main class="page">
    <section class="chat-card">
      <aside class="chat-sidebar">
        <div>
          <div class="chat-sidebar-header-title">Xin ch√†o üëã</div>
          <div class="badge">
            <span id="bot-status-dot" class="badge-dot checking"></span>
            <span id="bot-status-text">ƒêang k·∫øt n·ªëi‚Ä¶</span>
          </div>
        </div>

        <div>
          <div class="sidebar-section-title">G·ª£i √Ω c√¢u h·ªèi</div>
          <div class="quick-questions">
            <button class="quick-question" data-text="ƒêi·ªÉm chu·∫©n ng√†nh C√¥ng ngh·ªá th√¥ng tin nƒÉm 2025">
              ƒêi·ªÉm chu·∫©n CNTT 2025?
            </button>
            <button class="quick-question" data-text="ƒêi·ªÉm chu·∫©n An to√†n th√¥ng tin nƒÉm 2024 ·ªü H√† N·ªôi">
              ATTT 2024 H√† N·ªôi?
            </button>
            <button class="quick-question" data-text="C√°c ng√†nh ƒë√†o t·∫°o t·∫°i PTIT">
              PTIT c√≥ nh·ªØng ng√†nh n√†o?
            </button>
          </div>
        </div>

        <div style="margin-top:auto;font-size:11px;opacity:0.9;">
          G√µ c√¢u h·ªèi ·ªü khung b√™n ph·∫£i<br />
          V√≠ d·ª•: <em>"ƒêi·ªÉm chu·∫©n CNTT ·ªü HCM nƒÉm 2023"</em>
        </div>
      </aside>

      <section class="chat-main">
        <header class="chat-header">
          <div>
            <div class="chat-header-title">Khung chat t∆∞ v·∫•n tuy·ªÉn sinh</div>
            <div class="chat-header-sub">Bot s·∫Ω gi√∫p b·∫°n tra c·ª©u ƒëi·ªÉm chu·∫©n, ng√†nh h·ªçc, c∆° s·ªü ƒë√†o t·∫°o‚Ä¶</div>
          </div>
          <div class="chat-header-chip">Ng√¥n ng·ªØ: Ti·∫øng Vi·ªát</div>
        </header>

        <div id="messages" class="chat-messages"></div>

        <footer class="chat-input-wrapper">
          <div class="chat-input-row">
            <textarea
              id="user-input"
              class="chat-input"
              rows="1"
              placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n v·ªÅ tuy·ªÉn sinh PTIT..."
            ></textarea>
            <button id="send-btn" class="send-btn">
              <span>G·ª≠i</span>
              <span>‚û§</span>
            </button>
          </div>
          <div class="helper-text">
            <span>Nh·∫•n Enter ƒë·ªÉ g·ª≠i ¬∑ Shift + Enter ƒë·ªÉ xu·ªëng d√≤ng</span>
            <span id="error-banner" class="error-banner">Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c t·ªõi m√°y ch·ªß RASA.</span>
          </div>
        </footer>
      </section>
    </section>
  </main>

  <script>
    const params = new URLSearchParams(window.location.search);
    const defaultOrigin = `${window.location.protocol}//${window.location.hostname}:5005`;
    const RASA_ORIGIN = (params.get("rasa") || defaultOrigin).replace(/\/+$/, "");
    const RASA_ENDPOINT = `${RASA_ORIGIN}/webhooks/rest/webhook`;
    const RASA_STATUS = `${RASA_ORIGIN}/status`;
    const SENDER_ID = "ptit_web_user";

    const messagesEl = document.getElementById("messages");
    const inputEl = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const errorBanner = document.getElementById("error-banner");
    const statusDot = document.getElementById("bot-status-dot");
    const statusText = document.getElementById("bot-status-text");
    const endpointLabel = document.getElementById("rasa-endpoint-label");

    function setBotStatus(state) {
      statusDot.classList.remove("online", "offline", "checking");
      if (state === "online") {
        statusDot.classList.add("online");
        statusText.textContent = "Bot ƒëang tr·ª±c tuy·∫øn";
        return;
      }
      if (state === "offline") {
        statusDot.classList.add("offline");
        statusText.textContent = "Bot ƒëang offline";
        return;
      }
      statusDot.classList.add("checking");
      statusText.textContent = "ƒêang k·∫øt n·ªëi‚Ä¶";
    }

    async function checkServer() {
      try {
        const res = await fetch(RASA_STATUS, { method: "GET" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        setBotStatus("online");
      } catch {
        setBotStatus("offline");
      }
    }

    function appendMessage(sender, text) {
      const row = document.createElement("div");
      row.className = "message-row " + sender;

      const avatar = document.createElement("div");
      avatar.className = "avatar " + sender;
      avatar.textContent = sender === "user" ? "üôÇ" : "ü§ñ";

      const content = document.createElement("div");
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = text;

      const meta = document.createElement("div");
      meta.className = "meta";
      const now = new Date();
      meta.textContent = now.toLocaleTimeString("vi-VN", { hour: "2-digit", minute: "2-digit" });

      content.appendChild(bubble);
      content.appendChild(meta);

      if (sender === "user") {
        row.appendChild(content);
        row.appendChild(avatar);
      } else {
        row.appendChild(avatar);
        row.appendChild(content);
      }

      messagesEl.appendChild(row);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;

      errorBanner.classList.remove("visible");

      appendMessage("user", text);
      inputEl.value = "";
      inputEl.style.height = "40px";

      sendBtn.disabled = true;

      try {
        const res = await fetch(RASA_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            sender: SENDER_ID,
            message: text,
          }),
        });

        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        if (Array.isArray(data) && data.length > 0) {
          data.forEach((msg) => {
            if (msg.text) {
              appendMessage("bot", msg.text);
            }
          });
        } else {
          appendMessage("bot", "Hi·ªán t·∫°i m√¨nh ch∆∞a c√≥ ph·∫£n h·ªìi cho c√¢u h·ªèi n√†y. B·∫°n th·ª≠ h·ªèi c√°ch kh√°c nh√©!");
        }
      } catch (e) {
        errorBanner.classList.add("visible");
        setBotStatus("offline");
        appendMessage(
          "bot",
          "Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi m√°y ch·ªß RASA.\n\nG·ª£i √Ω:\n1) Ch·∫°y `start_chat_ui.ps1` ƒë·ªÉ t·ª± b·∫≠t server + m·ªü giao di·ªán.\n2) Ho·∫∑c t·ª± ch·∫°y `python -m rasa run --enable-api --cors \"*\" --port 5005`.\n3) M·ªü giao di·ªán qua `http://localhost:8000/chatbot_ui.html` (ƒë·ª´ng m·ªü file tr·ª±c ti·∫øp ƒë·ªÉ tr√°nh l·ªói CORS)."
        );
        console.error(e);
      } finally {
        sendBtn.disabled = false;
        inputEl.focus();
      }
    }

    sendBtn.addEventListener("click", sendMessage);

    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    inputEl.addEventListener("input", () => {
      inputEl.style.height = "auto";
      inputEl.style.height = Math.min(inputEl.scrollHeight, 80) + "px";
    });

    document.querySelectorAll(".quick-question").forEach((btn) => {
      btn.addEventListener("click", () => {
        inputEl.value = btn.dataset.text || btn.textContent.trim();
        sendMessage();
      });
    });

    // L·ªùi ch√†o m·∫∑c ƒë·ªãnh
    appendMessage(
      "bot",
      "Ch√†o b·∫°n! M√¨nh l√† chatbot t∆∞ v·∫•n tuy·ªÉn sinh PTIT. B·∫°n c√≥ th·ªÉ h·ªèi v·ªÅ:\n‚Ä¢ ƒêi·ªÉm chu·∫©n c√°c ng√†nh (2020-2025)\n‚Ä¢ C∆° s·ªü H√† N·ªôi / TP.HCM\n‚Ä¢ Th√¥ng tin ng√†nh h·ªçc, t·ªï h·ª£p x√©t tuy·ªÉn..."
    );

    if (window.location.protocol === "file:") {
      appendMessage(
        "bot",
        "B·∫°n ƒëang m·ªü giao di·ªán b·∫±ng file tr·ª±c ti·∫øp. ƒê·ªÉ k·∫øt n·ªëi bot ·ªïn ƒë·ªãnh, h√£y ch·∫°y `start_chat_ui.ps1` ƒë·ªÉ m·ªü giao di·ªán qua `http://localhost:8000`."
      );
    }

    setBotStatus("checking");
    checkServer();
    setInterval(checkServer, 3000);
  </script>
</body>
</html>

